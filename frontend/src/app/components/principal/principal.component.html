<section class="container">
  <div class="logout-container">
    <button class="btn logout" [routerLink]="['']">Cerrar sesi칩n</button>
  </div>

  <h1>Desaf칤os del Rally Fotogr치fico</h1>

  @if (rolUsuario === "Administrador") {
    <div class="admin-panel-card">
      <h3>游녬 Panel de Administrador</h3>
      <p>Gestiona los usuarios del sistema desde aqu칤</p>
      <button [routerLink]="['/listaUsuarios/', id_usuario]">Ver Usuarios</button>
    </div>
  }


  <!-- Mostrar lista de desaf칤os -->
<div class="desafios-list">
  @for (desafio of desafios; track desafio.id_desafio) {
    <article class="desafio-card">
      <img [src]="desafio.foto_url" alt="Foto del desaf칤o" class="foto-desafio" />
      <h2>{{ desafio.nombre }}</h2>
      <p>{{ desafio.descripcion }}</p>
      <p>
        <strong>Desde:</strong> {{ desafio.fecha_inicio }} 
        <strong>Hasta:</strong> {{ desafio.fecha_fin }}
      </p>

      @if (rolUsuario === 'Administrador') {
        <div class="acciones-admin">
          <button (click)="modificar(desafio)">Editar</button>
          <button (click)="eliminarDesafio(desafio)">Eliminar</button>
        </div>
      }
      <button [routerLink]="['/detalle-desafio', desafio.id_desafio, this.id_usuario]">Ver galer칤a</button>
    </article>
  }
</div>

 @if (rolUsuario === 'Administrador') {
    @if(!editando){
      <div class="admin-actions">
        <button (click)="toggleForm()" class="btn-crear">Crear nuevo desaf칤o</button>
      </div>
    }
    <!-- Mostrar formulario si showForm est치 en true -->
    @if (showForm) {
      <form [formGroup]="desafioForm" (ngSubmit)="onSubmit()" class="form-crear-desafio">
        <label>
          Nombre:
          <input type="text" formControlName="nombre" required />
        </label>
        <label>
          Descripci칩n:
          <textarea formControlName="descripcion" required></textarea>
        </label>
        <label>
          Fecha de inicio:
          <input type="date" formControlName="fecha_inicio" required />
        </label>
        <label>
          Fecha de fin:
          <input type="date" formControlName="fecha_fin" required />
        </label>
        @if (!editando){
        <label>
          Foto del desaf칤o:
          <input type="file" (change)="onFileSelected($event)" required />
        </label>
        }
        @if (errorMessage) {
          <div class="alert alert-danger">
            {{ errorMessage }}
          </div>
        }
        <button type="submit" [disabled]="!desafioForm.valid">Guardar desaf칤o</button>
      </form>
    }
  }
</section>
